<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>リアルタイム Speech to Text (ひらがな変換付き)</title>
    <link href="./css/style.css" rel="stylesheet" type="text/css">
    <link href="./css/history.css" rel="stylesheet" type="text/css">
</head>
<body>
    <div class="app-left">
        <div class="split-inner">
            
    <div class="api-key-field">
        <p>gemini-api-key
            <input type="text" id="gemini-api-key">
            <button id="verify-api-key-button" class="green">APIキー確認</button>
        </p>
        <p>
            <label for="gemini-model-select">モデル選択：</label>
            <select id="gemini-model-select" class="gemini-model-select">
                <option value="gemini-2.5-flash" selected>gemini-2.5-flash</option>
                <option value="gemini-2.0-flash">gemini-2.0-flash</option>
                <option value="gemini-2.5-pro">gemini-2.5-pro</option>
                <option value="custom">その他</option>
            </select>
            <input type="text" id="gemini-custom-model" class="gemini-custom-model" placeholder="モデル名を入力">
        </p>
        <p id="api-key-status"></p>
        <p id="token-usage-display"></p>
    </div>
    
    <div class="container">
                <div class="header">
                    <h1>Speech to Text</h1>
                    <h2>音声をテキストに変換</h2>
                </div>

                <!-- タブナビゲーション -->
                <div class="tab-nav">
                    <button class="tab-btn active" id="tab-main">音声認識</button>
                    <button class="tab-btn" id="tab-history">履歴</button>
                </div>

                <!-- メインタブ内容 -->
                <div id="main-tab-content">

                    <div class="controls">
                        <div class="control-group">
                            <button id="startButton" disabled>音声認識を開始</button>
                            <button id="stopButton" disabled>音声認識を停止</button>
                            <button id="clearButton" disabled>クリア</button>
                        </div>
                        <div class="control-group">
                            <button id="summarizeButton" class="green">テキストを要約</button>
                            <button id="identifySpeakersButton" class="green">話者を識別</button>
                        </div>
                        <div class="control-group">
                            <button id="saveHistoryButton" class="green" disabled>履歴に保存</button>
                            <div class="save-menu-wrapper">
                                <button id="saveTxt" class="green">PCに保存 ▼</button>
                                <div id="saveMenu" class="save-dropdown-menu">
                                    <button class="save-menu-item" data-format="txt">TXT形式で保存</button>
                                    <button class="save-menu-item" data-format="json">JSON形式で保存（原文+話者識別）</button>
                                </div>
                            </div>
                            <button id="importData" class="green">読み込み</button>
                            <input type="file" id="importFileInput" accept=".json">
                        </div>
                    </div>

                    <div class="result-area-container">
                        <div class="result-area-content">
                            <p class="result-area-header">認識結果 (原文):</p>
                            <div id="resultText" class="result-area" contenteditable>ここに認識されたテキストが表示されます...</div>
                        </div>
                        <!-- ひらがな表示削除
                        <div class="result-area-content">
                            <p class="result-area-header">認識結果 (ひらがな):</p>
                            <div id="hiraganaText" class="result-area" contenteditable>ここにひらがなで表示されます...</div>
                        </div>
                    -->
                    </div>

            <!-- 要約結果表示エリア -->
            <div id="summary-container" class="result-area-container">
                <div class="result-area-content">
                    <p class="result-area-header">要約結果:</p>
                    <div id="summary-result" class="result-area" contenteditable>要約結果がここに表示されます...</div>
                </div>
            </div>

            <!-- 話者識別結果表示エリア -->
            <!--<div id="speaker-json-container" class="result-area-container">
                <div class="result-area-content">
                    <p class="result-area-header">話者識別結果 (JSON):</p>
                    <div id="speaker-json-result" class="result-area" contenteditable>話者識別結果がJSON形式でここに表示されます...</div>
                </div>
            </div>-->

                    <p id="status">ステータス: アイドル</p>
                </div>

                <!-- 履歴タブ内容 -->
                <div id="history-tab-content" style="display:none;">
                    <div class="history-controls">
                        <input type="text" id="history-search" placeholder="履歴検索...">
                        <button id="history-clear" class="history-btn">履歴クリア</button>
                        <button id="history-export" class="history-btn">エクスポート</button>
                        <label class="history-import-label">
                          インポート<input type="file" id="history-import" accept="application/json">
                        </label>
                    </div>
                    <div id="history-stats" class="history-stats"></div>
                    <div id="history-empty" class="history-message">履歴がありません</div>
                    <div id="history-list" style="display:none;"></div>
                </div>
            </div> <!-- /.container (内側) -->
        </div> <!-- /.split-inner -->
    </div> <!-- /.app-left -->
    <div class="app-right">
        <div class="timeline-container">
            <div class="timeline-header">
                <button class="timeline-export" id="bulkRenameSpeakerButton" title="話者名を一括変更">話者名一括変更</button>
            </div>
            <div class="timeline-content" id="timelineContent">
                <!-- タイムラインアイテムがここに追加されます -->
            </div>
        </div>
    </div>
    <script type="module">
        import { GoogleGenAI } from "https://esm.run/@google/genai";
        window.GoogleGenAI = GoogleGenAI;
    </script>
    <script src="./js/debugLogger.js"></script>
    <script src="./js/vibeLogger.js"></script>
    <script src="./js/debugUI.js"></script>
    <script src="./js/domElements.js"></script>
    <script src="./js/speechRecognition.js"></script>
    <script src="./js/textToSpeech.js"></script>
    <script src="./js/tabManager.js"></script>
    <!-- タイムライン描画のみ（軽量レンダラ） -->
    <script src="./js/timelineRenderer.js"></script>
    <script src="./js/uiManager.js"></script>
    <script src="./js/geminiManager.js"></script>
    <script src="./js/main.js"></script>
</body>
</html>
