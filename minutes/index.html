<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>リアルタイム Speech to Text (ひらがな変換付き)</title>
    <link href="./css/style.css" rel="stylesheet" type="text/css">
    <link href="./css/history.css" rel="stylesheet" type="text/css">
    <!-- ここから追加: 左右分割レイアウト -->
    <style>
        html, body { height: 100%; }
        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: row;
            background: #fff;
            font-family: inherit;
        }
        /* 左半分：既存 UI を収める領域 */
        .app-left {
            width: 50%;
            min-width: 320px;
            background: #f6f8fa; /* 必要なら変更 */
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 24px 0;
            box-sizing: border-box;
        }
        /* 内側で既存 .container の幅制御を維持 */
        .split-inner {
            width: 100%;
            max-width: 1100px;
            padding: 0 24px;
            box-sizing: border-box;
        }
        /* 右半分：タイムライン表示領域 */
        .app-right {
            width: 50%;
            background: #ffffff;
            border-left: 1px solid #eee;
            box-sizing: border-box;
            display: flex;
            align-items: stretch;
            justify-content: center;
            padding: 32px;
            overflow: hidden;
        }
        .app-right .placeholder {
            color: #666;
            font-size: 18px;
            text-align: center;
        }
        /* レスポンシブ: 狭い画面は縦並び（右は下に） */
        @media (max-width: 900px) {
            body { flex-direction: column; }
            .app-left, .app-right { width: 100%; }
            .app-right { border-left: none; border-top: 1px solid #eee; padding: 16px; }
        }
    </style>
    <!-- ここまで追加 -->
</head>
<body>
    <div class="app-left">
        <div class="split-inner">
            
    <div class="api-key-field">
        <p style="color:black">gemini-api-key
            <input type="text" id="gemini-api-key" style="border:1px solid #000000;">
            <button id="verify-api-key-button" class="green">APIキー確認</button>
        </p>
        <p id="api-key-status" style="color:black; font-size:12px; margin-top:4px;"></p>
        <p id="token-usage-display" style="color:black; font-size:12px; margin-top:4px; display:none;"></p>
        <p id="rate-limit-display" style="color:black; font-size:12px; margin-top:4px; display:none;"></p>
    </div>
    
    <div class="container">
                <div class="header">
                    <h1>Speech to Text</h1>
                    <h2>音声をテキストに変換</h2>
                </div>

                <!-- タブナビゲーション -->
                <div class="tab-nav">
                    <button class="tab-btn active" id="tab-main">音声認識</button>
                    <button class="tab-btn" id="tab-history">履歴</button>
                </div>

                <!-- メインタブ内容 -->
                <div id="main-tab-content">

                    <div class="controls">
                        <button id="startButton" disabled>音声認識を開始</button>
                        <button id="stopButton" disabled>音声認識を停止</button>
                        <button id="clearButton" disabled>クリア</button>
                        <button id="saveHistoryButton" class="green" disabled>履歴に保存</button>
                        <button id="saveTxt" class="green">TXT保存</button>
                        <br>
                        <br>
                        <button id="summarizeButton" class="green">テキストを要約</button>
                        <button id="identifySpeakersButton" class="green">話者を識別</button>

                        <!-- 以下の部分を削除 
                        <button id="speakAllButton" class="green">最初から読み上げる</button>
                        <button id="speakNewButton" class="green">追加部分だけ読み上げる</button>
                        <button id="speakStopButton" class="red">読み上げ停止</button>
                        
                        <br>
                        <label for="voiceSelect">声の種類：</label>
                        <select id="voiceSelect"></select>
                        -->
                    </div>

                    <div class="result-area-container">
                        <div class="result-area-content">
                            <p class="result-area-header">認識結果 (原文):</p>
                            <div id="resultText" class="result-area" contenteditable>ここに認識されたテキストが表示されます...</div>
                        </div>
                        <!-- ひらがな表示削除
                        <div class="result-area-content">
                            <p class="result-area-header">認識結果 (ひらがな):</p>
                            <div id="hiraganaText" class="result-area" contenteditable>ここにひらがなで表示されます...</div>
                        </div>
                    -->
                    </div>

            <!-- 要約結果表示エリア -->
            <div id="summary-container" class="result-area-container" style="display:none; margin-top:20px;">
                <div class="result-area-content">
                    <p class="result-area-header">要約結果:</p>
                    <div id="summary-result" class="result-area" contenteditable style="background-color:#f0f8ff;">要約結果がここに表示されます...</div>
                </div>
            </div>

            <!-- 話者識別結果表示エリア -->
            <div id="speaker-json-container" class="result-area-container" style="display:none; margin-top:20px;">
                <div class="result-area-content">
                    <p class="result-area-header">話者識別結果 (JSON):</p>
                    <div id="speaker-json-result" class="result-area" contenteditable style="background-color:#f0fff0; font-family: monospace; white-space: pre-wrap;">話者識別結果がJSON形式でここに表示されます...</div>
                </div>
            </div>

                    <p id="status">ステータス: アイドル</p>
                </div>

                <!-- 履歴タブ内容 -->
                <div id="history-tab-content" style="display:none;">
                    <div class="history-controls">
                        <input type="text" id="history-search" placeholder="履歴検索..." style="width:180px; margin-right:8px;">
                        <button id="history-clear" class="history-btn">履歴クリア</button>
                        <button id="history-export" class="history-btn">エクスポート</button>
                        <label class="history-import-label">
                          インポート<input type="file" id="history-import" accept="application/json" style="display:none;">
                        </label>
                    </div>
                    <div id="history-stats" class="history-stats"></div>
                    <div id="history-empty" class="history-message">履歴がありません</div>
                    <div id="history-list" style="display:none;"></div>
                </div>
            </div> <!-- /.container (内側) -->
        </div> <!-- /.split-inner -->
    </div> <!-- /.app-left -->
    <div class="app-right">
        <div class="timeline-container">
            <div class="timeline-header">
                <button class="timeline-tab active">話者によって色分け</button>
                <button class="timeline-tab">話した時間を記録</button>
                <button class="timeline-export" id="exportJsonButton" title="タイムラインをJSONでエクスポート">JSONエクスポート</button>
            </div>
            <div class="timeline-content" id="timelineContent">
                <!-- タイムラインアイテムがここに追加されます -->
            </div>
            <button class="record-button" id="recordButton">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <circle cx="12" cy="12" r="8"/>
                </svg>
            </button>
        </div>
    </div>
    <script type="module">
        import { GoogleGenAI } from "https://esm.run/@google/genai";
        window.GoogleGenAI = GoogleGenAI;
    </script>
    <script src="./js/debugLogger.js"></script>
    <script src="./js/vibeLogger.js"></script>
    <script src="./js/debugUI.js"></script>
    <script src="./js/domElements.js"></script>
    <script src="./js/speechRecognition.js"></script>
    <script src="./js/textToSpeech.js"></script>
    <script src="./js/tabManager.js"></script>
    <!-- タイムライン描画のみ（軽量レンダラ） -->
    <script src="./js/timelineRenderer.js"></script>
    <script src="./js/uiManager.js"></script>
    <script src="./js/geminiManager.js"></script>
    <script src="./js/main.js"></script>
</body>
</html>
